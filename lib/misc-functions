#!/bin/bash
#
# miscellaneous functions that don't belong anywhere else

aws-unset() {
  unset AWS_PROFILE
  unset AWS_SHARED_CREDENTIALS_FILE
  unset AWS_SECURITY_TOKEN
}

awslogin() {
  local account="${1:?}"
  aws-unset
  aws-vault exec --no-session "$1"
}
complete -o default -F _aws-vault_bash_autocomplete awslogin


awslogin-firefox(){
  local account="${1:?}"
  local url=$(aws-vault login "${account}" -s | jq -s -R -r @uri)
  (nohup firefox "ext+container:name=$account&url=$url" &>/dev/null) &
}
complete -o default -F _bma_aws-vault_completion awslogin-firefox

awslogin-sso() {
  local profile="${1:-${AWS_PROFILE}}"
  local sso_start_url="$(aws configure get sso_start_url --profile "${profile}")"
  local sso_region="${AWS_SSO_REGION:-$(aws configure get sso_region --profile "${profile}")}"
  aws sso login --no-browser --profile "${profile}"
}

# Handy function to columnise output

columnise() {
  # Check if no arguments are provided
  if [ $# -eq 0 ]; then
    if ! [[ -t 1 ]]; then
      cat
    else
      column -t -s $'\t'
    fi
  else
    # Loop through all arguments
    for file in "$@"; do
      if [ -e "$file" ]; then
        # Process the file if it exists
        column -t -s $'\t' < "$file"
      else
        # Print an error message if the file doesn't exist
        echo "Error: File '$file' does not exist" >&2
      fi
    done
  fi
}

