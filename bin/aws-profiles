#!/usr/bin/env python

import configparser
import os

def list_aws_profiles(config_file, credentials_file):
    # Initialize a set to hold unique profile names
    profile_names = set()

    # Function to parse a file and extract profile names
    def parse_file(file_path):
        if os.path.exists(file_path):
            config = configparser.ConfigParser()
            config.read(file_path)
            for section in config.sections():
                if "sso-session" not in section:
                    # For 'config' file, strip 'profile ' prefix
                    profile_name = section.replace("profile ", "") if file_path.endswith("config") else section
                    profile_names.add(profile_name)

    # Parse the config and credentials files
    parse_file(config_file)
    parse_file(credentials_file)

    # Print the profile names
    for profile_name in sorted(profile_names):
        print(profile_name)

# Paths to the AWS config and credentials files
aws_config_file = os.getenv("AWS_CONFIG_FILE", os.path.expanduser("~/.aws/config"))
aws_credentials_file = os.getenv("AWS_SHARED_CREDENTIALS_FILE", os.path.expanduser("~/.aws/credentials"))

list_aws_profiles(aws_config_file, aws_credentials_file)
